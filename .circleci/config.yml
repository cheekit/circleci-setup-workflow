version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@0.0.2
  continuation: circleci/continuation@0.1.2

jobs:
  build:
    docker:
      - image: cimg/python:3.8
    steps:
      - checkout
      - run:
          name: get branch
          command: |
              branch=production
              echo 'export BASE_REVISION=$branch' >> $BASH_ENV
      - path-filtering/set-parameters:
          base-revision: production
          mapping: |
            src/server/.* build-server true
            src/client/.* build-client true
      - continuation/continue:
          configuration_path: .circleci/continue_config.yml
          parameters: /tmp/pipeline-parameters.json

workflows:
  setup-workflow:
    jobs:
      - build
